<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Starting Divemap…</title>
    <style>
      html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;}
      .wrap{display:flex;align-items:center;justify-content:center;height:100%;color:#374151}
      .box{max-width:32rem;text-align:center;padding:16px}
      .spinner{width:48px;height:48px;border:4px solid #E5E7EB;border-top-color:#0072B2;border-radius:50%;margin:0 auto 16px;animation:spin 1s linear infinite}
      @keyframes spin {to{transform:rotate(360deg)}}
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="box">
        <div class="spinner"></div>
        <h1>Starting Divemap…</h1>
        <p>Warming up services. This typically takes a few seconds.</p>
        <p id="quip" style="margin-top:8px;opacity:.85">🤿 Finding the scuba gear…</p>
      </div>
    </div>
    <script>
      // Poll backend /health and reload when healthy (with debug logging and timeout)
      async function poll() {
        const startedAt = Date.now();
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort('timeout'), 1000);
        try {
          const res = await fetch('/health', { cache: 'no-store', signal: controller.signal });
          console.log('[Divemap Loading] /health', new Date(startedAt).toISOString(), res.status);
          if (res.ok) {
            location.reload();
            return;
          }
        } catch (e) {
          console.log('[Divemap Loading] /health error', e);
        } finally {
          clearTimeout(timeoutId);
        }
        setTimeout(poll, 500);
      }
      poll();

      // Lighthearted rotating messages while we wait for the ocean (services) to warm up
      const quips = [
        '🤿 Finding the scuba gear…',
        '🐟 Counting fish… 1, 2, 3… so many fish!',
        '🌊 Calibrating dive computer…',
        '🧭 Checking currents and compass bearings…',
        '🐠 Shoaling assets… I mean fish.',
        '🦑 Negotiating with the squid for faster ink-ternet…',
        '🐡 Inflating the BCD… gently.',
        '🪸 Untangling lines from the coral (carefully)…',
        '🦈 Asking the sharks for an ETA…',
        '📡 Pinging the dive boat—almost there…'
      ];
      const quipEl = document.getElementById('quip');
      let quipIdx = 0;
      setInterval(() => {
        quipIdx = (quipIdx + 1) % quips.length;
        if (quipEl) quipEl.textContent = quips[quipIdx];
      }, 1200);
    </script>
  </body>
  </html>


