---
description: Testing requirements and standards for backend and frontend development in the Divemap project
globs: ["**/*", "backend/**/*", "frontend/**/*", "**/*.{py,js,jsx,ts,tsx}"]
alwaysApply: true
---

# Testing Standards

See `docs/development/testing.md` for details.

## Critical Rules

⚠️ **NEVER run tests inside `divemap_backend` container** - Connects to live MySQL, teardown drops tables (data loss).

⚠️ **NEVER use system Python** - Use project venv.

## Backend: Quick (Host Venv)

```bash
cd backend
source divemap_venv/bin/activate
export PYTHONPATH="/home/kargig/src/divemap/backend/divemap_venv/lib/python3.11/site-packages:$PYTHONPATH"
# Required to avoid OAuth-related failures
export GOOGLE_CLIENT_ID="dummy-client-id-for-testing"
python -m pytest tests/ -v
```

If you run tests this way you can safely ignore tests containing
failures like: `sqlite3.OperationalError: no such function: POINT`

If you get such errors, use backend/docker-test-github-actions.sh
to run tests.

## Backend: CI-like (Isolated Docker)

```bash
cd backend
./docker-test-github-actions.sh
```

## Frontend Testing

Host (fast iteration):

```bash
cd frontend
npm test
```

Docker dev image (isolated Node):

```bash
cd frontend
docker build -f Dockerfile.dev -t divemap_frontend_dev .
docker run --rm divemap_frontend_dev npm run test:frontend
docker run --rm divemap_frontend_dev npm run test:validation
docker run --rm divemap_frontend_dev npm run test:e2e
```

## DO NOT

- Do not execute `pytest` inside `divemap_backend` (use host venv or CI script).
- Do not run backend tests without activating the venv and setting `PYTHONPATH`.
